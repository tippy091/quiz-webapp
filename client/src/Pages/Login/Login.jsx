import React, { useCallback, useState } from "react";
import LoginBanner from "../../assets/background.png";
import { useDispatch } from "react-redux";
import { Link, useNavigate } from "react-router-dom";
import { setLoading } from "../../Features/Common";
import { saveToken } from "../../Utils/JwtHelper";
import { loginAPI } from "../../API/Authentication";
import { setIsLoggedIn } from "../../Reducer/Features/AuthorityFeatures";
import { FcGoogle } from "react-icons/fc";
import { FaMicrosoft, FaApple } from "react-icons/fa";
// import { setIsLoggedIn } from "../../Reducer/Features/AuthorityFeatures";
const Login = () => {
  const [values, setValues] = useState({
    userName: "",
    password: "",
  });

  const [error, setError] = useState("");
  const dispatch = useDispatch();
  const navigate = useNavigate();

  const onSubmit = useCallback(
    (e) => {
      e.preventDefault();
      setError("");
      dispatch(setLoading(true));
      loginAPI(values)
        .then((res) => {
          if (res?.data.token) {
            saveToken(res?.data.token);

            dispatch(setIsLoggedIn(true));
            navigate("/");
          } else {
            setError("Sai thông tin đăng nhập hoặc mật khẩu");
          }
        })
        .catch((error) => {
          setError(error);
        })
        .finally(() => {
          dispatch(setLoading(false));
        });
    },
    [dispatch, navigate, values]
  );

  // Kiểm tra thay đổi của Input và cập nhật vào values liên tục
  const handleOnChange = useCallback((e) => {
    e.persist();
    setValues((values) => ({
      ...values,
      [e.target.name]: e.target?.value,
    }));
  }, []);

  return (
    <div className="min-h-screen flex">
      {/* Bên trái: Form đăng nhập */}
      <div
        className="w-full lg:w-2/5
       max-w-3xl mx-auto my-auto"
      >
        <div className="text-center">
          <img
            src="https://share-gcdn.basecdn.net/brand/logo.full.png"
            alt="Logo"
            className="mx-auto h-12"
          />
          <h2 className="text-2xl font-bold mt-6">Đăng nhập</h2>
          <p className="text-sm text-gray-500">
            Chào mừng trở lại. Đăng nhập để bắt đầu làm việc.
          </p>
        </div>

        <form onSubmit={onSubmit} className="mt-6 space-y-4">
          <div>
            <label name="userName" className="block text-sm font-medium">
              Email
            </label>
            <input
              onChange={handleOnChange}
              htmlFor="userName"
              type="userName"
              // value={email}
              // onChange={(e) => setEmail(e.target.value)}
              className="w-full mt-1 px-3 py-2 border
             border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Email của bạn"
              name="userName"
              required
            />
          </div>

          <div>
            <label name="password" className="block text-sm font-medium">
              Mật khẩu
            </label>
            <input
              type="password"
              htmlFor="password"
              onChange={handleOnChange}
              name="password"
              className="w-full mt-1 px-3 py-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Mật khẩu của bạn"
              required
            />
            <div className="text-right mt-1">
              <a href="#" className="text-sm text-blue-500 hover:underline">
                Quên mật khẩu?
              </a>
            </div>
          </div>

          <div className="flex items-center space-x-2">
            <input
              type="checkbox"
              // checked={rememberMe}
              // onChange={() => setRememberMe(!rememberMe)}
            />
            <label className="text-sm">Giữ tôi luôn đăng nhập</label>
          </div>

          <button
            type="submit"
            className="w-full bg-blue-600 text-white py-2  hover:bg-blue-700 transition"
          >
            Đăng nhập
          </button>
        </form>

        {/* Đăng nhập với Base ID */}
        <button className="mt-2 w-full flex items-center justify-center border border-gray-300 py-2">
          <span className="mr-2">
            <svg
              width="16"
              height="16"
              viewBox="0 0 64 64"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M29.7204 0.0616112C28.3231 0.170109 27.9327 0.216606 26.6344 0.433601C25.7793 0.576199 24.6515 0.811794 24.0349 0.976089C23.0465 1.23958 21.9342 1.57748 21.2029 1.84097C20.8064 1.98357 19.5887 2.46716 19.1704 2.65005C18.6809 2.86085 17.1348 3.62653 16.5368 3.95512C14.9504 4.8231 13.1564 6.03828 11.7962 7.15735C10.1479 8.51202 8.50882 10.1395 7.35312 11.5624C6.49486 12.6194 5.97433 13.3169 5.39803 14.1849C5.24001 14.4205 5.0727 14.6716 5.02622 14.7398C4.75046 15.1459 4.07811 16.299 3.65673 17.0957C3.46463 17.4553 2.9348 18.5465 2.77059 18.9092C2.16021 20.2794 1.48166 22.161 1.18731 23.2801C1.15323 23.4072 1.06337 23.7482 0.989012 24.0396C0.691566 25.1648 0.511859 26.0948 0.270184 27.7285C-0.0582457 29.9759 -0.092328 33.2371 0.195823 35.6953C0.236102 36.0549 0.459186 37.5243 0.533548 37.9273C0.611008 38.3396 0.930143 39.7965 0.964225 39.8957C0.979717 39.9391 1.04478 40.1685 1.10675 40.4072C1.37631 41.4395 1.99909 43.2808 2.3678 44.1426C2.88213 45.3423 3.12691 45.8724 3.49871 46.5916C4.43753 48.405 5.48479 50.0573 6.64359 51.5391C6.74893 51.6786 6.90695 51.88 6.9937 51.9885C7.30045 52.3853 8.09054 53.3029 8.49333 53.7369C8.85584 54.1244 10.0518 55.3148 10.4174 55.6496C11.2819 56.44 12.3446 57.3049 13.2618 57.959C13.5282 58.1481 13.804 58.3465 13.8721 58.393C14.0921 58.5542 15.0371 59.1618 15.443 59.4067C15.8582 59.6578 16.6421 60.1073 16.6607 60.1073C16.6669 60.1073 16.7413 60.1476 16.8218 60.1972C17.1564 60.3925 18.1944 60.9039 18.9535 61.2449C20.5771 61.9765 22.5353 62.6492 24.3075 63.0832C25.1038 63.2754 25.3393 63.3281 26.2502 63.4986C27.2572 63.6877 28.2208 63.8117 29.7514 63.9419C30.6624 64.0194 33.327 64.0194 34.2596 63.9419C35.3967 63.8458 36.7197 63.6877 37.3115 63.5792C39.6787 63.1421 41.1566 62.7484 43.059 62.054C44.444 61.5456 46.0459 60.8233 47.1954 60.1848C47.3348 60.1073 47.4557 60.0453 47.4619 60.0453C47.4742 60.0453 47.6694 59.9337 48.3108 59.5524C49.3457 58.9448 50.8019 57.9559 51.5641 57.3483C51.6416 57.2863 51.843 57.1251 52.0134 56.9887C53.3054 55.9627 54.5975 54.7382 55.9143 53.2874C56.2737 52.8937 56.9151 52.1218 57.3271 51.5825C57.386 51.505 57.4511 51.4213 57.4728 51.3965C58.0646 50.6401 58.9476 49.335 59.5084 48.3895C60.0909 47.4037 60.8903 45.8693 61.2435 45.0571C62.4581 42.2641 63.18 39.8151 63.6448 36.8888C63.747 36.2626 63.8369 35.4225 63.9608 33.9593C64.0197 33.2805 64.0104 30.6021 63.9453 29.8519C63.7904 27.9889 63.6572 27.0217 63.3535 25.4965C63.2451 24.9479 62.9817 23.8567 62.8733 23.4816C62.8361 23.3607 62.7648 23.1189 62.7153 22.9391C62.4085 21.8572 61.8694 20.3848 61.2776 19.0177C61.1103 18.6302 60.4813 17.3437 60.2334 16.8787C59.2079 14.9599 57.7671 12.8581 56.3388 11.1904C55.9824 10.7781 55.8616 10.6417 55.4681 10.2139C55.2047 9.92869 54.0181 8.74142 53.7764 8.52442C53.6741 8.43142 53.4634 8.23923 53.3054 8.09663C53.1505 7.95403 52.9677 7.79284 52.9026 7.74014C52.8345 7.68434 52.6641 7.54174 52.5215 7.42085C50.7771 5.94838 48.7384 4.59681 46.5757 3.47773C44.8592 2.58805 42.6191 1.70767 40.7662 1.19308C40.5617 1.13729 40.2891 1.05979 40.162 1.02569C39.9359 0.96059 38.9599 0.731197 38.4269 0.619598C38.0489 0.539001 36.5183 0.284809 36.0845 0.232109C35.5547 0.167011 35.1426 0.12981 34.2131 0.0616112C33.1039 -0.0220871 30.808 -0.0189896 29.7204 0.0616112ZM33.0357 9.2839C34.6593 9.3366 36.7662 9.6838 38.334 10.155C40.0474 10.6727 41.4169 11.24 42.8886 12.0428C43.8398 12.5605 44.8747 13.2332 45.7856 13.9276C47.2419 15.0374 48.6423 16.4106 49.8042 17.8738C50.9135 19.2688 51.9421 20.9365 52.6393 22.4741C52.9801 23.2212 53.0328 23.3514 53.2621 23.9466C54.0212 25.9305 54.5138 28.1408 54.6749 30.2859C54.7276 31.0051 54.7307 32.9953 54.6749 33.7052C54.4921 36.1634 53.8972 38.6123 52.9398 40.8567C52.7198 41.3744 52.4441 41.9727 52.4069 42.0099C52.3883 42.0285 51.9266 41.8146 51.1892 41.4519C50.0304 40.8784 49.262 40.5002 45.9436 38.8603C44.8623 38.3241 44.3449 38.0544 44.3542 38.0296C44.3635 38.0079 44.4688 37.7723 44.5865 37.5088C45.1443 36.2564 45.4665 35.0567 45.6524 33.5409C45.7484 32.7566 45.7484 31.2221 45.6524 30.4471C45.547 29.607 45.4665 29.1762 45.2868 28.5035C45.1474 27.9765 45.1071 27.8525 44.946 27.3968C43.9235 24.5325 41.9839 22.0897 39.437 20.4468C37.6121 19.2719 35.5268 18.5403 33.3456 18.314C32.8405 18.2644 31.1209 18.2613 30.6654 18.314C29.2185 18.4814 28.0752 18.7635 26.8234 19.2719C24.8343 20.081 23.1797 21.262 21.6491 22.9701C21.3021 23.3576 20.6545 24.2256 20.3509 24.7123C18.8699 27.0806 18.1448 29.8736 18.2843 32.6667C18.3276 33.5595 18.3772 33.9531 18.5538 34.7963C18.684 35.4194 18.7428 35.6488 18.9256 36.2099C19.8892 39.1858 21.8164 41.7247 24.4346 43.4606C25.2123 43.9783 26.2595 44.5177 27.0558 44.8184C27.7406 45.0757 27.9358 45.1377 28.574 45.302C29.2805 45.4849 29.8103 45.5779 30.7119 45.674C31.973 45.8104 33.7484 45.7019 35.0187 45.4105C35.8893 45.2121 36.887 44.8804 37.5625 44.5673C37.7236 44.4929 37.8847 44.4216 37.9219 44.4092C37.9963 44.3844 37.9963 44.3875 38.9846 46.4211C39.1427 46.7435 39.4184 47.3108 39.5981 47.6765C39.7747 48.0423 40.1156 48.7398 40.3479 49.2265C40.5834 49.7132 41.0265 50.6308 41.3363 51.2694C41.6462 51.9048 41.8971 52.438 41.8971 52.4504C41.8971 52.5 40.7135 53.0208 39.9173 53.3184C38.619 53.802 37.3053 54.1585 35.9792 54.3879C34.5199 54.6421 33.5872 54.7196 31.9978 54.7196C30.5384 54.7196 29.4199 54.6328 28.2983 54.4313C28.1 54.3972 27.8614 54.3538 27.7684 54.3383C27.2944 54.2577 26.5074 54.0717 25.6925 53.8454C25.3052 53.7369 24.5523 53.4858 24.0318 53.2905C21.519 52.345 19.2819 51.0183 17.1812 49.2234C16.4252 48.5786 15.2757 47.4223 14.6932 46.7187C14.6158 46.6257 14.5042 46.4924 14.4422 46.4242C14.1386 46.077 13.4074 45.0819 12.9829 44.4371C11.4957 42.168 10.4422 39.6973 9.84113 37.0593C9.56537 35.8472 9.41355 34.8087 9.30201 33.389C9.26173 32.8589 9.26173 31.1322 9.30201 30.6083C9.45383 28.6399 9.711 27.1984 10.2253 25.4655C10.7025 23.8536 11.4337 22.1641 12.2982 20.6637C12.5243 20.2732 12.5801 20.1802 13.017 19.5044C13.2401 19.1603 13.9155 18.2241 14.213 17.8552C17.1069 14.2283 21.1193 11.5004 25.4447 10.2232C26.9969 9.76749 28.354 9.504 29.9683 9.3459C30.5539 9.2901 31.7716 9.24051 32.1837 9.256C32.3386 9.26221 32.7197 9.2746 33.0357 9.2839ZM32.9118 24.3217C33.8909 24.4488 34.7336 24.7092 35.5454 25.1339C36.4316 25.5988 37.0388 26.0669 37.7453 26.8326C38.7801 27.9517 39.4928 29.5326 39.6787 31.1198C39.8305 32.4001 39.6384 33.7455 39.1365 34.9513C39.0373 35.1931 38.9537 35.3977 38.9537 35.407C38.9537 35.4163 39.1241 35.5093 39.3348 35.6116C40.2116 36.0425 43.2852 37.5584 43.7624 37.794C44.0443 37.9366 44.2798 38.0668 44.2798 38.0854C44.286 38.1691 43.7345 39.1362 43.3906 39.6477C43.2047 39.9205 42.6531 40.6676 42.6098 40.7017C42.6005 40.711 42.4734 40.8567 42.3278 41.0272C41.5935 41.8828 40.5741 42.7756 39.5578 43.4513C39.0931 43.7613 38.0923 44.3286 38.0148 44.3286C37.9901 44.3286 37.8847 44.1147 37.0327 42.3447C36.8158 41.8921 36.4997 41.2442 36.3355 40.9032C36.1682 40.5622 35.8893 39.9856 35.7127 39.6229C35.4122 39.0029 35.3564 38.9223 35.279 38.9936C35.2387 39.0308 34.5787 39.2912 34.3309 39.3687C33.9807 39.4772 33.2216 39.6415 32.8963 39.6818C32.4966 39.7314 31.5268 39.7314 31.1302 39.6818C29.4044 39.471 27.8304 38.7177 26.588 37.5057C26.1356 37.0655 25.7607 36.5881 25.3703 35.965C25.203 35.6984 24.8591 34.973 24.7475 34.6568C24.6855 34.477 24.6236 34.2972 24.6081 34.2538C24.543 34.0709 24.4811 33.8075 24.4067 33.4076C24.1061 31.7739 24.3292 30.1309 25.0543 28.6275C26.1728 26.3149 28.3788 24.703 30.9133 24.3527C31.4246 24.2814 31.4277 24.2814 32.0287 24.2814C32.3355 24.2814 32.7321 24.3 32.9118 24.3217Z"
                fill="#1E88E5"
              ></path>
            </svg>
          </span>
          Đăng nhập bằng Base ID
        </button>

        <div className="mt-4 text-center text-sm text-gray-500">
          hoặc đăng nhập thông qua SSO
        </div>

        {/* SSO Buttons */}
        <div className="mt-6 grid grid-cols-2 gap-2">
          <button className="w-full flex items-center justify-center py-2 bg-gray-100">
            <FcGoogle className="mr-2" /> Đăng nhập bằng Google
          </button>
          <button className="w-full flex items-center justify-center py-2 bg-gray-100">
            <FaMicrosoft className="mr-2 text-blue-600" /> Đăng nhập bằng
            Microsoft
          </button>
          <button className="w-full flex items-center justify-center py-2 bg-gray-100">
            <FaApple className="mr-2" /> Đăng nhập bằng Apple
          </button>
          <button className="w-full flex items-center justify-center py-2 bg-gray-100">
            <FaMicrosoft className="mr-2" /> Đăng nhập bằng SAML
          </button>
        </div>

        <div className="mt-6 text-center text-sm text-gray-500">
          <a href="#" className="text-blue-500 hover:underline">
            Đăng nhập với quyền truy cập của tài khoản Khách?
          </a>
        </div>
      </div>

      {/* Bên phải: Hình nền */}
      <div
        className="hidden lg:block w-2/4 bg-gradient-to-b from-blue-600 to-blue-900 relative"
        style={{
          backgroundImage: `url(${LoginBanner})`,
          backgroundSize: "cover",
          backgroundRepeat: "no-repeat",
          backgroundPosition: "center",
        }}
      >
        {/* Add icons floating like the design, or animation here if needed */}
      </div>
    </div>
  );
};

export default Login;
